dependencies:
  override:
    - nvm install 6
    # use 6 so npm 3 installs our dependencies
    - nvm use 6 && npm install
    # set up my gatsby fork
    - nvm use 6 && pushd .. && git clone https://github.com/scottnonnenberg/gatsby.git && pushd gatsby && git checkout anchors && npm install && npm run build && npm link && popd && popd && npm link gatsby
    # empty piwik.js placeholder
    - 'echo "module.exports = {};" > piwik.js'
test:
  override:
    - nvm use 4 && npm run test
    - nvm use 6 && npm run ci-with-server

